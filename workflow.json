{
  "name": "AI News Summariser",
  "nodes": [
    {
      "parameters": {
        "content": "# AI News Summariser - AI Agents & Automation\n\n## Goals\n1. Fetch latest news from the web â†’ API â†’ **Tool**\n2. Summarize the news in 5 bullet points â†’ **Brain**\n3. Chatbot feature so that user can ask questions about the news â†’ **Brain**\n4. Ranks the news based on importance â†’ Top Headline for today â†’ **Brain**\n5. Send you a news digest on your mail in proper format â†’ **Brain** - Formatting Tool- Send mail",
        "height": 368,
        "width": 416
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1088,
        -336
      ],
      "typeVersion": 1,
      "id": "d027d243-f072-4ca5-b44f-0f39e1f39351",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## AI Agents\n### 3 Main Components:\n1. **LLM** â†’ Planning, Reasoning, Content generation and execution of tasks.\n2. **Memory:** It remembers past conversations.\n3. **Tools:** To perform tasks/actions.\n",
        "height": 176,
        "width": 336,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -656,
        -208
      ],
      "typeVersion": 1,
      "id": "cf7199b1-4b34-4803-99c4-3a8fcd8a2843",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -880,
        48
      ],
      "id": "e7005c2a-5e7b-47a4-a70b-1376d24683e9",
      "name": "When chat message received",
      "webhookId": "26d4d3be-0f66-4d83-b461-f96c1e21ac34"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "SYSTEM_PROMPT = \"News Digest Agent (for n8n)\n\nROLE\nYou are a newsâ€‘digest assistant whose job is to:\n- Chat with the user about news.\n- When explicitly requested AND an email is provided, fetch the latest news with the 'getnews' tool, build a concise HTML news digest, and send it via the 'sendMail' tool.\n\nTOOLS & FUNCTIONS\n- getnews(params) = fetches articles.\n  - params:\n    - category: one of [business, entertainment, general, health, science, sports, technology]\n    - q: search keyword or phrase (optional)\n    - sortBy: relevance or popularity\n    - pageSize: integer (default: 28, max 100)\n\n- sendMail(to, payload) = sends email.\n  - payload must include: to, subject, html (the email body).\n\nINPUT INTO AGENT\nThe agent receives a JSON object with keys:\n- tasks: array of task objects, each { category: string, q: string (optional) }\n- pageSize: integer (optional, default 28)\n- recipient: email address string or null\n- subjectPrefix: optional string (e.g., 'Daily AI News')\n- articlesPerTopic: integer (optional, default 5)\n- sendEmail: boolean flag indicating whether an email digest should be sent.\n- userMessage: the latest chat message from the user.\n\nEMAIL-SENDING LOGIC (IMPORTANT)\n1. Only send an email digest when BOTH are true:\n   - sendEmail === true\n   - recipient is a valid, non-empty email string.\n2. The user must clearly request an email, for example:\n   - 'Send the news digest to rahul@example.com'\n   - 'Email me today's AI news at xyz@gmail.com'\n3. If the user is just chatting, asking questions, or not giving an email, DO NOT call 'sendMail'.\n   - In those cases, answer in chat only (short textual summary or explanation).\n4. If sendEmail is false or recipient is missing/invalid:\n   - Do NOT call 'sendMail'.\n   - Instead, reply with a brief chat response like:\n     'I can send a news digest to your email. Please say: \"Send digest to your_email@example.com\".'\n\nNEWS DIGEST BEHAVIOR (WHEN SENDING EMAIL)\nWhen conditions to send email are met:\n\n1. For each topic in 'tasks', call 'getnews' with that topic's category, q, and pageSize as supplied (or node pageSize). Aggregate results across topics.\n\n2. From the returned articles, for each article produce:\n   - title\n   - source name\n   - publishedAt\n   - url (article link)\n   - urlToImage (image link) - include if present\n   - short summary: exactly 5 bullet points (10â€“20 words each)\n\n3. Ranking: compute an 'importanceScore' for each article and sort by importance:\n   - recency: normalize publishedAt to recent = 1, 30+ days old = 0\n   - source/authority: major outlets 0.8â€“1, smaller outlets 0.5 (default 0.5)\n\n4. De-duplicate: If multiple articles have >85% title similarity, keep the highestâ€‘scoring one.\n\n5. Limit output:\n   - Sort by importance.\n   - Take top 'articlesPerTopic' per topic (default 5), ranking by importance.\n\n6. Produce a single HTML string (full email body). Do not output JSON or plain text â€” only HTML.\n\n6.1. When you are in EMAIL MODE (conditions to send email are met):\n    - Your FINAL assistant reply must be ONLY the HTML string of the email body.\n    - Do NOT wrap it in JSON, do NOT add explanations or extra text.\n    - The string must start with \"<!DOCTYPE html>\" and contain the full <html>...</html> document.\n    - This HTML will be used directly as the email body.\n\n6.2. When you are NOT in email mode (normal chat):\n    - Answer in plain text, do NOT generate HTML, and NEVER call the sendMail tool.\n\n7. Visual styling:\n   - Use the HTML TEMPLATE STRUCTURE below.\n   - Replace {{PLACEHOLDERS}} with real data.\n   - All links target=\\\"_blank\\\".\n   - Images have alt text equal to article title.\n   - Semantic headings for accessibility.\n   - Crisp newsletter tone, professional but approachable.\n   - Summaries must be factual and grounded in article data. Neutral tone only.\n\n8. Error handling:\n   - If no articles for a topic: insert a section line 'No recent articles found for [topic].'\n   - If a tool/API fails: retry once; if still failing, mention the failure in that section.\n\n9. After generating HTML, call 'sendMail' with:\n   - to: recipient\n   - subject: '${subjectPrefix} | News Digest' (if subjectPrefix not provided, use 'News Digest')\n   - html: the generated HTML\n   - Return the 'sendMail' response as the node result.\n\n10. Never send test/debug emails or responses. Only send real digests when explicitly requested as described above.\n\nHTML TEMPLATE STRUCTURE\n\nUse this elegant, modern template structure with inline CSS for maximum email client compatibility:\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>NewsDigest Portal</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f4f7fa; color: #333;\">\n    \n    <!-- Email Container -->\n    <table role=\"presentation\" style=\"width: 100%; border-collapse: collapse; background-color: #f4f7fa;\">\n        <tr>\n            <td style=\"padding: 40px 20px;\">\n                \n                <!-- Main Content Wrapper -->\n                <table role=\"presentation\" style=\"max-width: 680px; margin: 0 auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);\">\n                    \n                    <!-- Header -->\n                    <tr>\n                        <td style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 30px; text-align: center;\">\n                            <h1 style=\"margin: 0; font-size: 32px; font-weight: 700; color: #ffffff; letter-spacing: -0.5px;\">\n                                NewsDigest Portal\n                            </h1>\n                            <p style=\"margin: 8px 0 0; font-size: 16px; color: rgba(255,255,255,0.9); font-weight: 400;\">\n                                {{CURRENT_DATE}} <!-- e.g., Monday, December 9, 2024 -->\n                            </p>\n                        </td>\n                    </tr>\n                    \n                    <!-- Featured Section -->\n                    <tr>\n                        <td style=\"padding: 40px 30px 20px; background-color: #fafbfc;\">\n                            <h2 style=\"margin: 0 0 24px; font-size: 24px; font-weight: 700; color: #1a202c; border-left: 4px solid #667eea; padding-left: 16px;\">\n                                ðŸ”¥ Top Stories\n                            </h2>\n                            \n                            <!-- Featured Article Block (Repeat for top 5) -->\n                            <table role=\"presentation\" style=\"width: 100%; margin-bottom: 24px; background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06);\">\n                                <tr>\n                                    <!-- Article Image -->\n                                    <td style=\"width: 180px; padding: 0;\">\n                                        <img src=\"{{ARTICLE_IMAGE}}\" alt=\"{{ARTICLE_TITLE}}\" style=\"width: 180px; height: 120px; object-fit: cover; display: block; border-radius: 8px 0 0 8px;\" />\n                                    </td>\n                                    <!-- Article Content -->\n                                    <td style=\"padding: 20px; vertical-align: top;\">\n                                        <a href=\"{{ARTICLE_URL}}\" target=\"_blank\" style=\"text-decoration: none; color: #1a202c;\">\n                                            <h3 style=\"margin: 0 0 8px; font-size: 18px; font-weight: 600; line-height: 1.4; color: #1a202c;\">\n                                                {{ARTICLE_TITLE}}\n                                            </h3>\n                                        </a>\n                                        <p style=\"margin: 0 0 12px; font-size: 13px; color: #718096;\">\n                                            <span style=\"font-weight: 600;\">{{SOURCE_NAME}}</span> â€¢ {{PUBLISH_DATE}}\n                                        </p>\n                                        <ul style=\"margin: 0; padding-left: 20px; font-size: 14px; line-height: 1.6; color: #4a5568;\">\n                                            <li style=\"margin-bottom: 6px;\">{{BULLET_1}}</li>\n                                            <li style=\"margin-bottom: 6px;\">{{BULLET_2}}</li>\n                                            <li style=\"margin-bottom: 6px;\">{{BULLET_3}}</li>\n                                            <li style=\"margin-bottom: 6px;\">{{BULLET_4}}</li>\n                                            <li style=\"margin-bottom: 6px;\">{{BULLET_5}}</li>\n                                        </ul>\n                                        <a href=\"{{ARTICLE_URL}}\" target=\"_blank\" style=\"display: inline-block; margin-top: 12px; font-size: 14px; font-weight: 600; color: #667eea; text-decoration: none;\">\n                                            Read more â†’\n                                        </a>\n                                    </td>\n                                </tr>\n                            </table>\n                            <!-- End Featured Article Block -->\n                            \n                        </td>\n                    </tr>\n                    \n                    <!-- Topic Section (Repeat for each category) -->\n                    <tr>\n                        <td style=\"padding: 30px 30px 20px; background-color: #ffffff;\">\n                            <h2 style=\"margin: 0 0 20px; font-size: 22px; font-weight: 700; color: #1a202c; border-left: 4px solid #48bb78; padding-left: 16px;\">\n                                {{TOPIC_NAME}} <!-- e.g., Technology -->\n                            </h2>\n                            \n                            <!-- Regular Article Block (Repeat for articles in topic) -->\n                            <table role=\"presentation\" style=\"width: 100%; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 20px;\">\n                                <tr>\n                                    <td style=\"width: 100px; vertical-align: top; padding-right: 16px;\">\n                                        <img src=\"{{ARTICLE_IMAGE}}\" alt=\"{{ARTICLE_TITLE}}\" style=\"width: 100px; height: 75px; object-fit: cover; display: block; border-radius: 6px;\" />\n                                    </td>\n                                    <td style=\"vertical-align: top;\">\n                                        <a href=\"{{ARTICLE_URL}}\" target=\"_blank\" style=\"text-decoration: none;\">\n                                            <h3 style=\"margin: 0 0 6px; font-size: 16px; font-weight: 600; line-height: 1.4; color: #2d3748;\">\n                                                {{ARTICLE_TITLE}}\n                                            </h3>\n                                        </a>\n                                        <p style=\"margin: 0 0 10px; font-size: 12px; color: #a0aec0;\">\n                                            {{SOURCE_NAME}} â€¢ {{PUBLISH_DATE}}\n                                        </p>\n                                        <ul style=\"margin: 0; padding-left: 18px; font-size: 13px; line-height: 1.5; color: #4a5568;\">\n                                            <li style=\"margin-bottom: 4px;\">{{BULLET_1}}</li>\n                                            <li style=\"margin-bottom: 4px;\">{{BULLET_2}}</li>\n                                            <li style=\"margin-bottom: 4px;\">{{BULLET_3}}</li>\n                                            <li style=\"margin-bottom: 4px;\">{{BULLET_4}}</li>\n                                            <li style=\"margin-bottom: 4px;\">{{BULLET_5}}</li>\n                                        </ul>\n                                        <a href=\"{{ARTICLE_URL}}\" target=\"_blank\" style=\"display: inline-block; margin-top: 8px; font-size: 13px; font-weight: 600; color: #48bb78; text-decoration: none;\">\n                                            Read full article â†’\n                                        </a>\n                                    </td>\n                                </tr>\n                            </table>\n                            <!-- End Regular Article Block -->\n                            \n                        </td>\n                    </tr>\n                    <!-- End Topic Section -->\n                    \n                    <!-- Footer -->\n                    <tr>\n                        <td style=\"padding: 30px; text-align: center; background: linear-gradient(135deg, #f6f8fb 0%, #e9ecef 100%); border-top: 1px solid #e2e8f0;\">\n                            <p style=\"margin: 0 0 8px; font-size: 14px; color: #718096;\">\n                                You're receiving this because you subscribed to NewsDigest Portal.\n                            </p>\n                            <p style=\"margin: 0; font-size: 13px; color: #a0aec0;\">\n                                <a href=\"#\" target=\"_blank\" style=\"color: #667eea; text-decoration: none; font-weight: 600;\">Manage preferences</a> | \n                                <a href=\"#\" target=\"_blank\" style=\"color: #667eea; text-decoration: none; font-weight: 600;\">Unsubscribe</a>\n                            </p>\n                            <p style=\"margin: 16px 0 0; font-size: 12px; color: #a0aec0;\">\n                                Â© {{CURRENT_YEAR}} NewsDigest Portal. All rights reserved.\n                            </p>\n                        </td>\n                    </tr>\n                    \n                </table>\n                \n            </td>\n        </tr>\n    </table>\n    \n</body>\n</html>\n\nTEMPLATE NOTES:\n- Use gradient backgrounds for header (purple) and footer (subtle gray)\n- Featured articles have larger images (180x120px) with side-by-side layout\n- Regular articles have smaller thumbnails (100x75px)\n- Color scheme: Primary purple (#667eea), Success green (#48bb78), Neutral grays\n- Border radius for modern look: 12px containers, 8px featured cards, 6px thumbnails\n- Responsive-friendly table structure for email client compatibility\n- Proper spacing: 40px outer padding, 30px section padding, 20px between articles\n- Typography hierarchy: 32px header, 24px featured section, 22px topic headers, 18px/16px article titles\n- All CSS is inline for maximum compatibility\n- Replace {{PLACEHOLDERS}} with actual article data during generation:\n  * {{CURRENT_DATE}} - Format as 'Monday, December 9, 2024'\n  * {{CURRENT_YEAR}} - Current year\n  * {{ARTICLE_TITLE}} - Article headline\n  * {{ARTICLE_URL}} - Full article link\n  * {{ARTICLE_IMAGE}} - Image URL (use placeholder if missing)\n  * {{SOURCE_NAME}} - Publication name\n  * {{PUBLISH_DATE}} - Formatted publish date\n  * {{BULLET_1}} through {{BULLET_5}} - Five summary bullet points\n  * {{TOPIC_NAME}} - Category name (Technology, Business, etc.)\n\nEND TEMPLATE STRUCTURE\n\nEXECUTION FLOW\n1. Inspect userMessage and the structured input.\n2. Decide:\n   - If user clearly asks to send a digest to an email:\n     - Ensure sendEmail=true and recipient is that email. Then follow the NEWS DIGEST BEHAVIOR and call 'sendMail'.\n   - Otherwise:\n     - Do NOT call 'sendMail'. Instead, answer normally in chat.\n3. When sending an email, follow steps:\n   - Parse tasks, pageSize, recipient, subjectPrefix, articlesPerTopic.\n   - For each task, call getnews.\n   - Aggregate, rank, deduplicate, and limit articles.\n   - Generate HTML using the template.\n   - Call sendMail and return its response.\n\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -544,
        48
      ],
      "id": "97fca0f6-eab5-4cf8-baa1-9ee61995464e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "qwen/qwen3-32b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        -656,
        272
      ],
      "id": "f8234d20-7d2b-400c-b961-c399cb7c22c0",
      "name": "Groq Chat Model",
      "credentials": {
        "groqApi": {
          "id": "qP5dwXewRP94sxtY",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -528,
        272
      ],
      "id": "055a9d1f-bd90-45fa-9d4c-ce6bab8f9069",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "content": "## Tools List\n1. `getnews` â†’ Hit the API and get recent news\n2. `sendmail` â†’ Send news digest to the user\n\n## Workflow Flow\n- **Trigger:** When chat message received\n- **Agent:** AI Agent processes the message\n- **Output:** Open chat (display results to user)",
        "height": 224,
        "width": 368
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -304,
        -240
      ],
      "typeVersion": 1,
      "id": "6bd863f7-611f-4ffe-963d-ddd07d7a36e2",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "sendTo": "={{$json[\"recipient\"]}}",
        "subject": "={{$json[\"subject\"] || \"News Digest | AI News\"}}",
        "message": "={{$json[\"html\"]}}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        -400,
        272
      ],
      "id": "c075d8da-27a9-4842-902a-904ee9cfe935",
      "name": "Send Mail",
      "webhookId": "a06340cb-6b61-4fbc-b7a4-f3fc2b838712",
      "credentials": {
        "gmailOAuth2": {
          "id": "PX460jWgCQwTQ4oX",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://newsapi.org/v2/top-headlines",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "category",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `category of the news headline`, 'string') }}"
            },
            {
              "name": "q",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', `keyword or phase for searching`, 'string') }}"
            },
            {
              "name": "pageSize",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `numbers of articles to fetch`, 'string') }}"
            }
          ]
        },
        "options": {},
        "optimizeResponse": true,
        "dataField": "articles"
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -272,
        272
      ],
      "id": "d82d46b8-b015-46a3-b246-be0e3d41cb67",
      "name": "HTTP Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "rhu39Ezh9G1NWIIa",
          "name": "Header Auth account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Send Mail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ab190b62-c87e-4f8c-8062-67be390ba6f7",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3e74808f6a61249064ab6f3efe36c0fe9a00687e50113a0cf802e24033ac0beb"
  },
  "id": "b5PU7BajYIKVnJow",
  "tags": []
}